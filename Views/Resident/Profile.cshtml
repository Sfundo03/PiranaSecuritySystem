@model PiranaSecuritySystem.Controllers.UpdateResidentViewModel

@{
    ViewBag.Title = "Update Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-header bg-gradient-primary text-white text-center py-4 rounded-top-4">
                    <h3 class="mb-0"><i class="fas fa-user-edit me-2"></i>Update Profile</h3>
                    <p class="mb-0 opacity-75">Update your personal details securely</p>
                </div>
                <div class="card-body p-4">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
                            <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>@TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <div class="row g-4">
                        <!-- Form -->
                        <div class="col-md-6">
                            @using (Html.BeginForm("UpdateProfile", "Resident", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate", id = "updateProfileForm" }))
                            {
                                @Html.AntiForgeryToken()
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", placeholder = "Full Name", id = "FullNameInput" })
                                            @Html.LabelFor(m => m.FullName)
                                            @Html.ValidationMessageFor(m => m.FullName, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "Email", id = "EmailInput" })
                                            @Html.LabelFor(m => m.Email)
                                            @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control", placeholder = "Phone Number", id = "PhoneInput" })
                                            @Html.LabelFor(m => m.PhoneNumber)
                                            @Html.ValidationMessageFor(m => m.PhoneNumber, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.EmergencyContact, new { @class = "form-control", placeholder = "Emergency Contact", id = "EmergencyInput" })
                                            @Html.LabelFor(m => m.EmergencyContact)
                                            @Html.ValidationMessageFor(m => m.EmergencyContact, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.Address, new { @class = "form-control", placeholder = "Address", id = "AddressInput" })
                                            @Html.LabelFor(m => m.Address)
                                            @Html.ValidationMessageFor(m => m.Address, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating mb-3">
                                            @Html.TextBoxFor(m => m.UnitNumber, new { @class = "form-control", placeholder = "Unit Number", id = "UnitInput" })
                                            @Html.LabelFor(m => m.UnitNumber)
                                            @Html.ValidationMessageFor(m => m.UnitNumber, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-between mt-4">
                                        <a href="@Url.Action("Dashboard", "Resident")" class="btn btn-outline-secondary btn-lg">
                                            <i class="fas fa-times me-1"></i> Cancel
                                        </a>
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-save me-1"></i> Update Profile
                                        </button>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Live Preview Panel -->
                        <div class="col-md-6">
                            <div class="card shadow-sm border-0 rounded-4 p-3">
                                <div class="card-header bg-light text-dark rounded-top-4 text-center">
                                    <h5 class="mb-0"><i class="fas fa-eye me-1"></i>Live Preview</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Full Name:</strong> <span id="PreviewFullName">@Model.FullName</span></p>
                                    <p><strong>Email:</strong> <span id="PreviewEmail">@Model.Email</span></p>
                                    <p><strong>Phone:</strong> <span id="PreviewPhone">@Model.PhoneNumber</span></p>
                                    <p><strong>Emergency Contact:</strong> <span id="PreviewEmergency">@Model.EmergencyContact</span></p>
                                    <p><strong>Address:</strong> <span id="PreviewAddress">@Model.Address</span></p>
                                    <p><strong>Unit Number:</strong> <span id="PreviewUnit">@Model.UnitNumber</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .bg-gradient-primary {
            background: linear-gradient(90deg, #0069aa, #00aaff);
        }

        .form-floating > .form-control:focus ~ label {
            color: #0069aa;
        }

        .btn-primary {
            background-color: #0069aa;
            border-color: #0069aa;
        }

            .btn-primary:hover {
                background-color: #004a7c;
                border-color: #004a7c;
            }
    </style>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        (function () {
            'use strict';
            var forms = document.querySelectorAll('.needs-validation');
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        // Live preview functionality
        $(document).ready(function () {
            $('#FullNameInput').on('input', function () {
                $('#PreviewFullName').text($(this).val());
            });
            $('#EmailInput').on('input', function () {
                $('#PreviewEmail').text($(this).val());
            });
            $('#PhoneInput').on('input', function () {
                $('#PreviewPhone').text($(this).val());
            });
            $('#EmergencyInput').on('input', function () {
                $('#PreviewEmergency').text($(this).val());
            });
            $('#AddressInput').on('input', function () {
                $('#PreviewAddress').text($(this).val());
            });
            $('#UnitInput').on('input', function () {
                $('#PreviewUnit').text($(this).val());
            });
        });
    </script>
}
