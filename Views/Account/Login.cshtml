@using PiranaSecuritySystem.Models
@model LoginViewModel
@{
    ViewBag.Title = "Log in";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white text-center">
                    <h2>PIRANA GUARDING</h2>
                    <p class="mb-0">Secure Access Management System</p>
                </div>
                <div class="card-body">
                    <h4 class="text-center mb-4">System Login</h4>

                    @using (Html.BeginForm("Login", "Account", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { role = "form", id = "loginForm" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                        <!-- Role Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Select Your Role</label>
                            <div class="row">
                                <div class="col-6 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input role-radio" type="radio" name="SelectedRole" id="roleAdmin" value="Admin" required>
                                        <label class="form-check-label" for="roleAdmin">
                                            Administrator
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input role-radio" type="radio" name="SelectedRole" id="roleDirector" value="Director" required>
                                        <label class="form-check-label" for="roleDirector">
                                            Director
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input role-radio" type="radio" name="SelectedRole" id="roleGuard" value="Guard" required>
                                        <label class="form-check-label" for="roleGuard">
                                            Security Guard
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input role-radio" type="radio" name="SelectedRole" id="roleInstructor" value="Instructor" required>
                                        <label class="form-check-label" for="roleInstructor">
                                            Instructor
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <span class="text-danger field-validation-error" data-valmsg-for="SelectedRole" data-valmsg-replace="true">
                                <span id="SelectedRole-error" class=""></span>
                            </span>
                        </div>

                        <!-- Credentials Section -->
                        <div id="credentialsSection">
                            <div class="mb-3">
                                @Html.LabelFor(m => m.Email, new { @class = "form-label" })
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "name@example.com" })
                                @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
                            </div>

                            <div class="mb-3">
                                @Html.LabelFor(m => m.Password, new { @class = "form-label" })
                                @Html.PasswordFor(m => m.Password, new { @class = "form-control", placeholder = "Enter your password" })
                                @Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger" })
                            </div>

                            <div class="mb-3 form-check">
                                @Html.CheckBoxFor(m => m.RememberMe, new { @class = "form-check-input" })
                                @Html.LabelFor(m => m.RememberMe, new { @class = "form-check-label" })
                            </div>

                            <button type="submit" class="btn btn-primary w-100">Log In</button>

                            <div class="text-center mt-3">
                                @Html.ActionLink("Forgot your password?", "ForgotPassword")
                            </div>
                        </div>
                    }

                    <div class="text-center mt-4 pt-3 border-top">
                        <p class="mb-2">Are you a resident?</p>
                        <a href="@Url.Action("Index", "Resident")" class="btn btn-outline-secondary">
                            Access Resident Portal
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $(document).ready(function () {
            // Auto-fill credentials based on role selection
            $('.role-radio').change(function () {
                var role = $(this).val();
                var email = "";
                var password = "";

                switch (role) {
                    case "Admin":
                        email = "admin@pirana.com";
                        password = "admin123";
                        break;
                    case "Director":
                        email = "director@pirana.com";
                        password = "director123";
                        break;
                    case "Guard":
                        email = "";
                        password = "";
                        break;
                    case "Instructor":
                        email = "";
                        password = "";
                        break;
                }

                $('#Email').val(email);
                $('#Password').val(password);

                if (email && password) {
                    $('#Password').focus();
                }
            });

            // Custom validation for role selection
            $('#loginForm').submit(function (e) {
                var roleSelected = $('input[name="SelectedRole"]:checked').val();
                if (!roleSelected) {
                    e.preventDefault();
                    $('#SelectedRole-error').text('Please select a role');
                    return false;
                }
            });
        });
    </script>
}